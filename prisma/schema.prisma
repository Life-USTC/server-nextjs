generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model AdminClass {
  id   Int  @id @default(autoincrement())
  jwId Int?

  nameCn String  @unique
  nameEn String?

  sections Section[] @relation("SectionAdminClasses")

  @@index([nameCn])
}

model Building {
  id   Int @id @default(autoincrement())
  jwId Int @unique

  nameCn String
  nameEn String?
  code   String

  campusId Int?

  campus Campus? @relation(fields: [campusId], references: [id])

  rooms Room[]

  @@index([nameCn])
  @@index([nameEn])
  @@index([campusId])
}

model Campus {
  id   Int  @id @default(autoincrement())
  jwId Int?

  nameCn    String     @unique
  nameEn    String?
  buildings Building[]
  sections  Section[]

  @@index([nameCn])
  @@index([nameEn])
}

model ClassType {
  id Int @id @default(autoincrement())

  nameCn String  @unique
  nameEn String?

  courses Course[]

  @@index([nameCn])
  @@index([nameEn])
}

model Course {
  id   Int @id @default(autoincrement())
  jwId Int @unique

  code   String  @unique
  nameCn String
  nameEn String?

  categoryId       Int?
  classTypeId      Int?
  classifyId       Int?
  educationLevelId Int?
  gradationId      Int?
  typeId           Int?

  category       CourseCategory?  @relation(fields: [categoryId], references: [id])
  classType      ClassType?       @relation(fields: [classTypeId], references: [id])
  classify       CourseClassify?  @relation(fields: [classifyId], references: [id])
  educationLevel EducationLevel?  @relation(fields: [educationLevelId], references: [id])
  gradation      CourseGradation? @relation(fields: [gradationId], references: [id])
  type           CourseType?      @relation(fields: [typeId], references: [id])

  sections Section[]

  @@index([code])
  @@index([nameCn])
  @@index([nameEn])
  @@index([categoryId])
  @@index([classTypeId])
  @@index([classifyId])
  @@index([educationLevelId])
  @@index([gradationId])
  @@index([typeId])
}

model CourseCategory {
  id Int @id @default(autoincrement())

  nameCn String  @unique
  nameEn String?

  courses Course[]

  @@index([nameCn])
  @@index([nameEn])
}

model CourseClassify {
  id Int @id @default(autoincrement())

  nameCn String  @unique
  nameEn String?

  courses Course[]

  @@index([nameCn])
  @@index([nameEn])
}

model CourseGradation {
  id Int @id @default(autoincrement())

  nameCn String  @unique
  nameEn String?

  courses Course[]

  @@index([nameCn])
  @@index([nameEn])
}

model CourseType {
  id Int @id @default(autoincrement())

  nameCn String  @unique
  nameEn String?

  courses Course[]

  @@index([nameCn])
  @@index([nameEn])
}

model Department {
  id Int @id @default(autoincrement())

  code      String   @unique
  nameCn    String
  nameEn    String?
  isCollege Boolean?

  sections Section[]
  teachers Teacher[]

  @@index([code])
  @@index([nameCn])
  @@index([nameEn])
}

model EducationLevel {
  id Int @id @default(autoincrement())

  nameCn String  @unique
  nameEn String?

  courses Course[]

  @@index([nameCn])
  @@index([nameEn])
}

model ExamMode {
  id Int @id @default(autoincrement())

  nameCn String  @unique
  nameEn String?

  sections Section[]

  @@index([nameCn])
  @@index([nameEn])
}

model Room {
  id   Int @id @default(autoincrement())
  jwId Int @unique

  nameCn          String
  nameEn          String?
  code            String
  floor           Int?
  virtual         Boolean
  seatsForSection Int
  remark          String?
  seats           Int

  buildingId Int?
  roomTypeId Int?

  building Building? @relation(fields: [buildingId], references: [id])
  roomType RoomType? @relation(fields: [roomTypeId], references: [id])

  schedules Schedule[]

  @@unique([buildingId, code])
  @@index([nameCn])
  @@index([nameEn])
}

model RoomType {
  id   Int @id @default(autoincrement())
  jwId Int @unique

  nameCn String
  nameEn String?
  code   String

  rooms Room[]

  @@index([nameCn])
  @@index([nameEn])
}

model Schedule {
  id Int @id @default(autoincrement())

  periods       Int
  date          DateTime? @db.Date
  weekday       Int
  startTime     Int
  endTime       Int
  experiment    String?
  customPlace   String?
  lessonType    String?
  weekIndex     Int
  exerciseClass Boolean?
  startUnit     Int
  endUnit       Int

  roomId          Int?
  sectionId       Int
  teacherId       Int?
  scheduleGroupId Int

  room          Room?         @relation(fields: [roomId], references: [id])
  section       Section       @relation(fields: [sectionId], references: [id])
  teacher       Teacher?      @relation(fields: [teacherId], references: [id])
  scheduleGroup ScheduleGroup @relation(fields: [scheduleGroupId], references: [id])

  @@index([date])
  @@index([roomId])
  @@index([sectionId])
  @@index([teacherId])
  @@index([scheduleGroupId])
}

model ScheduleGroup {
  id   Int @id @default(autoincrement())
  jwId Int @unique

  no            Int
  limitCount    Int
  stdCount      Int
  actualPeriods Int
  isDefault     Boolean

  sectionId Int

  section Section @relation(fields: [sectionId], references: [id])

  schedules Schedule[]
}

model Section {
  id   Int @id @default(autoincrement())
  jwId Int @unique

  code                    String
  credits                 Float?
  period                  Int?
  periodsPerWeek          Int?
  stdCount                Int?
  limitCount              Int?
  graduateAndPostgraduate Boolean?
  dateTimePlaceText       String?
  dateTimePlacePersonText Json?

  courseId         Int
  semesterId       Int?
  campusId         Int?
  examModeId       Int?
  openDepartmentId Int?
  teachLanguageId  Int?

  course         Course         @relation(fields: [courseId], references: [id])
  semester       Semester?      @relation(fields: [semesterId], references: [id])
  campus         Campus?        @relation(fields: [campusId], references: [id])
  examMode       ExamMode?      @relation(fields: [examModeId], references: [id])
  openDepartment Department?    @relation(fields: [openDepartmentId], references: [id])
  teachLanguage  TeachLanguage? @relation(fields: [teachLanguageId], references: [id])

  schedules      Schedule[]
  scheduleGroups ScheduleGroup[]
  adminClasses   AdminClass[]    @relation("SectionAdminClasses")
  teachers       Teacher[]       @relation("SectionTeachers")

  @@index([code])
  @@index([period])
  @@index([graduateAndPostgraduate])
  @@index([courseId])
  @@index([semesterId])
  @@index([examModeId])
  @@index([campusId])
  @@index([openDepartmentId])
}

model Semester {
  id   Int @id @default(autoincrement())
  jwId Int @unique

  nameCn    String    @unique
  code      String    @unique
  startDate DateTime? @db.Date
  endDate   DateTime? @db.Date

  sections Section[]
}

model Teacher {
  id Int @id @default(autoincrement())

  personId  Int?    @unique
  teacherId Int?    @unique
  nameCn    String
  nameEn    String?

  departmentId   Int?
  teacherTitleId Int?
  department     Department? @relation(fields: [departmentId], references: [id])

  sections  Section[]  @relation("SectionTeachers")
  schedules Schedule[]

  @@unique([nameCn, departmentId])
  @@index([nameCn])
  @@index([nameEn])
}

model TeachLanguage {
  id Int @id @default(autoincrement())

  nameCn String  @unique
  nameEn String?

  sections Section[]

  @@index([nameCn])
  @@index([nameEn])
}
