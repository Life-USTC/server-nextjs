generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model AdminClass {
  id   Int  @id @default(autoincrement())
  jwId Int? @unique

  code      String?
  grade     String?
  nameCn    String   @unique
  nameEn    String?
  stdCount  Int?
  planCount Int?
  enabled   Boolean?
  abbrZh    String?
  abbrEn    String?

  sections Section[] @relation("SectionAdminClasses")

  @@index([jwId])
  @@index([code])
  @@index([nameCn])
}

model Building {
  id   Int @id @default(autoincrement())
  jwId Int @unique

  nameCn String
  nameEn String?
  code   String

  campusId Int?

  campus Campus? @relation(fields: [campusId], references: [id])

  rooms Room[]

  @@index([jwId])
  @@index([nameCn])
  @@index([nameEn])
  @@index([campusId])
}

model Campus {
  id   Int  @id @default(autoincrement())
  jwId Int? @unique

  nameCn String  @unique
  nameEn String?
  code   String?

  buildings Building[]
  sections  Section[]

  @@index([jwId])
  @@index([code])
  @@index([nameCn])
  @@index([nameEn])
}

model ClassType {
  id Int @id @default(autoincrement())

  nameCn String  @unique
  nameEn String?

  courses Course[]

  @@index([nameCn])
  @@index([nameEn])
}

model Course {
  id   Int @id @default(autoincrement())
  jwId Int @unique

  code   String
  nameCn String
  nameEn String?

  categoryId       Int?
  classTypeId      Int?
  classifyId       Int?
  educationLevelId Int?
  gradationId      Int?
  typeId           Int?

  category       CourseCategory?  @relation(fields: [categoryId], references: [id])
  classType      ClassType?       @relation(fields: [classTypeId], references: [id])
  classify       CourseClassify?  @relation(fields: [classifyId], references: [id])
  educationLevel EducationLevel?  @relation(fields: [educationLevelId], references: [id])
  gradation      CourseGradation? @relation(fields: [gradationId], references: [id])
  type           CourseType?      @relation(fields: [typeId], references: [id])

  sections Section[]

  @@index([jwId])
  @@index([code])
  @@index([nameCn])
  @@index([nameEn])
  @@index([categoryId])
  @@index([classTypeId])
  @@index([classifyId])
  @@index([educationLevelId])
  @@index([gradationId])
  @@index([typeId])
}

model CourseCategory {
  id Int @id @default(autoincrement())

  nameCn String  @unique
  nameEn String?

  courses Course[]

  @@index([nameCn])
  @@index([nameEn])
}

model CourseClassify {
  id Int @id @default(autoincrement())

  nameCn String  @unique
  nameEn String?

  courses Course[]

  @@index([nameCn])
  @@index([nameEn])
}

model CourseGradation {
  id Int @id @default(autoincrement())

  nameCn String  @unique
  nameEn String?

  courses Course[]

  @@index([nameCn])
  @@index([nameEn])
}

model CourseType {
  id Int @id @default(autoincrement())

  nameCn String  @unique
  nameEn String?

  courses Course[]

  @@index([nameCn])
  @@index([nameEn])
}

model Department {
  id Int @id @default(autoincrement())

  code      String   @unique
  nameCn    String
  nameEn    String?
  isCollege Boolean?

  sections Section[]
  teachers Teacher[]

  @@index([code])
  @@index([nameCn])
  @@index([nameEn])
}

model EducationLevel {
  id Int @id @default(autoincrement())

  nameCn String  @unique
  nameEn String?

  courses Course[]

  @@index([nameCn])
  @@index([nameEn])
}

model ExamMode {
  id Int @id @default(autoincrement())

  nameCn String  @unique
  nameEn String?

  sections Section[]

  @@index([nameCn])
  @@index([nameEn])
}

model Room {
  id   Int @id @default(autoincrement())
  jwId Int @unique

  nameCn          String
  nameEn          String?
  code            String
  floor           Int?
  virtual         Boolean
  seatsForSection Int
  remark          String?
  seats           Int

  buildingId Int?
  roomTypeId Int?

  building Building? @relation(fields: [buildingId], references: [id])
  roomType RoomType? @relation(fields: [roomTypeId], references: [id])

  schedules Schedule[]

  @@unique([buildingId, code])
  @@index([jwId])
  @@index([nameCn])
  @@index([nameEn])
}

model RoomType {
  id   Int @id @default(autoincrement())
  jwId Int @unique

  nameCn String
  nameEn String?
  code   String

  rooms    Room[]
  sections Section[]

  @@index([jwId])
  @@index([nameCn])
  @@index([nameEn])
}

model Schedule {
  id Int @id @default(autoincrement())

  periods       Int
  date          DateTime? @db.Date
  weekday       Int
  startTime     Int
  endTime       Int
  experiment    String?
  customPlace   String?
  lessonType    String?
  weekIndex     Int
  exerciseClass Boolean?
  startUnit     Int
  endUnit       Int

  roomId          Int?
  sectionId       Int
  scheduleGroupId Int

  room          Room?         @relation(fields: [roomId], references: [id])
  section       Section       @relation(fields: [sectionId], references: [id])
  scheduleGroup ScheduleGroup @relation(fields: [scheduleGroupId], references: [id])
  teachers      Teacher[]     @relation("ScheduleTeachers")

  @@index([date])
  @@index([roomId])
  @@index([sectionId])
  @@index([scheduleGroupId])
}

model ScheduleGroup {
  id   Int @id @default(autoincrement())
  jwId Int @unique

  no            Int
  limitCount    Int
  stdCount      Int
  actualPeriods Int
  isDefault     Boolean

  sectionId Int

  section Section @relation(fields: [sectionId], references: [id])

  schedules Schedule[]

  @@index([jwId])
}

model Section {
  id   Int @id @default(autoincrement())
  jwId Int @unique

  code                    String
  bizTypeId               Int?
  credits                 Float?
  period                  Int?
  periodsPerWeek          Int?
  timesPerWeek            Int?
  stdCount                Int?
  limitCount              Int?
  graduateAndPostgraduate Boolean?
  dateTimePlaceText       String?
  dateTimePlacePersonText Json?

  actualPeriods     Int?
  theoryPeriods     Float?
  practicePeriods   Float?
  experimentPeriods Float?
  machinePeriods    Float?
  designPeriods     Float?
  testPeriods       Float?

  scheduleState           String?
  suggestScheduleWeeks    Json?
  suggestScheduleWeekInfo String?
  scheduleJsonParams      Json?
  selectedStdCount        Int?
  remark                  String?
  scheduleRemark          String?

  courseId         Int
  semesterId       Int?
  campusId         Int?
  examModeId       Int?
  openDepartmentId Int?
  teachLanguageId  Int?
  roomTypeId       Int?

  course         Course         @relation(fields: [courseId], references: [id])
  semester       Semester?      @relation(fields: [semesterId], references: [id])
  campus         Campus?        @relation(fields: [campusId], references: [id])
  examMode       ExamMode?      @relation(fields: [examModeId], references: [id])
  openDepartment Department?    @relation(fields: [openDepartmentId], references: [id])
  teachLanguage  TeachLanguage? @relation(fields: [teachLanguageId], references: [id])
  roomType       RoomType?      @relation(fields: [roomTypeId], references: [id])

  schedules             Schedule[]
  scheduleGroups        ScheduleGroup[]
  adminClasses          AdminClass[]           @relation("SectionAdminClasses")
  teachers              Teacher[]              @relation("SectionTeachers")
  teacherAssignments    TeacherAssignment[]
  exams                 Exam[]
  calendarSubscriptions CalendarSubscription[] @relation("SectionCalendarSubscriptions")

  @@index([jwId])
  @@index([code])
  @@index([bizTypeId])
  @@index([period])
  @@index([graduateAndPostgraduate])
  @@index([courseId])
  @@index([semesterId])
  @@index([examModeId])
  @@index([campusId])
  @@index([openDepartmentId])
  @@index([roomTypeId])
}

model Exam {
  id   Int @id @default(autoincrement())
  jwId Int @unique

  examType      Int?
  startTime     Int?
  endTime       Int?
  examDate      DateTime? @db.Date
  examTakeCount Int?
  examMode      String?

  examBatchId Int?
  sectionId   Int
  examBatch   ExamBatch? @relation(fields: [examBatchId], references: [id], onDelete: Cascade)
  section     Section    @relation(fields: [sectionId], references: [id], onDelete: Cascade)

  examRooms ExamRoom[]

  @@index([jwId])
  @@index([examType])
  @@index([examDate])
  @@index([examBatchId])
  @@index([sectionId])
}

model ExamBatch {
  id Int @id @default(autoincrement())

  nameCn String  @unique
  nameEn String?

  exams Exam[]

  @@index([nameCn])
}

model ExamRoom {
  id Int @id @default(autoincrement())

  room  String
  count Int

  examId Int
  exam   Exam @relation(fields: [examId], references: [id], onDelete: Cascade)

  @@index([examId])
  @@index([room])
}

model Semester {
  id   Int @id @default(autoincrement())
  jwId Int @unique

  nameCn    String
  code      String
  startDate DateTime? @db.Date
  endDate   DateTime? @db.Date

  sections Section[]

  @@index([jwId])
}

model Teacher {
  id Int @id @default(autoincrement())

  personId  Int?    @unique
  teacherId Int?    @unique
  code      String? @unique
  nameCn    String
  nameEn    String?
  age       Int?

  email     String?
  telephone String?
  mobile    String?
  address   String?
  postcode  String?
  qq        String?
  wechat    String?

  departmentId   Int?
  teacherTitleId Int?

  department   Department?   @relation(fields: [departmentId], references: [id])
  teacherTitle TeacherTitle? @relation(fields: [teacherTitleId], references: [id])

  sections           Section[]           @relation("SectionTeachers")
  teacherAssignments TeacherAssignment[]
  schedules          Schedule[]          @relation("ScheduleTeachers")

  @@unique([nameCn, departmentId])
  @@index([code])
  @@index([nameCn])
  @@index([nameEn])
  @@index([teacherTitleId])
}

model TeachLanguage {
  id Int @id @default(autoincrement())

  nameCn String  @unique
  nameEn String?

  sections Section[]

  @@index([nameCn])
  @@index([nameEn])
}

model TeacherTitle {
  id   Int @id @default(autoincrement())
  jwId Int @unique

  nameCn  String   @unique
  nameEn  String?
  code    String
  enabled Boolean?

  teachers Teacher[]

  @@index([jwId])
  @@index([nameCn])
}

model TeacherLessonType {
  id   Int @id @default(autoincrement())
  jwId Int @unique

  nameCn  String
  nameEn  String?
  code    String
  role    String?
  enabled Boolean?

  teacherAssignments TeacherAssignment[]

  @@index([jwId])
  @@index([nameCn])
}

model TeacherAssignment {
  id Int @id @default(autoincrement())

  teacherId Int
  sectionId Int

  role           String?
  period         Int?
  weekIndices    Json?
  weekIndicesMsg String?

  teacherLessonTypeId Int?

  teacher           Teacher            @relation(fields: [teacherId], references: [id])
  section           Section            @relation(fields: [sectionId], references: [id])
  teacherLessonType TeacherLessonType? @relation(fields: [teacherLessonTypeId], references: [id])

  @@unique([teacherId, sectionId])
  @@index([teacherId])
  @@index([sectionId])
  @@index([teacherLessonTypeId])
}

model CalendarSubscription {
  id Int @id @default(autoincrement())

  sections Section[] @relation("SectionCalendarSubscriptions")
}
